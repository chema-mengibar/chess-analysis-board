{"version":3,"sources":["webpack://chess-analysis-board/./src/js/Figure.js","webpack://chess-analysis-board/./src/js/chess/chess-const.js","webpack://chess-analysis-board/./src/js/chess/chess-utils.js","webpack://chess-analysis-board/./src/js/MovesRegistry.js","webpack://chess-analysis-board/./src/js/chess/chess-squares.js","webpack://chess-analysis-board/./src/js/chess/chess-svg.js","webpack://chess-analysis-board/./src/js/utils/clipboard.js","webpack://chess-analysis-board/./src/js/chess/chess-controls.js","webpack://chess-analysis-board/./src/js/utils/url.js","webpack://chess-analysis-board/./src/index.js","webpack://chess-analysis-board/./src/js/Chess.js"],"names":["Figure","config","this","letterW","iconW","letterB","iconB","color","rows","cols","fenBase","flankC","white","black","figures","b","r","n","k","q","p","getAbsoluteRouteWithFen","fen","window","location","origin","pathname","getCellKey","colLetter","rowNumber","asSquare","letter","createSquaresMap","listCells","forEach","row","col","cellKey","push","Map","createMarkersMap","parseFenStrToObject","squaresKeyVal","allowedLetters","split","rowText","rowIdw","boardRowIdx","currentCol","character","includes","toUpperCase","figureLetter","toLowerCase","jumpCols","parseInt","c","parseMapToFenStr","squaresMap","fenSquarePositions","emptyAccumulator","rowIdx","squareName","squarePiece","get","toString","pieceLetter","length","parseConfig","flip","asIcon","asLines","withLimitation","changeHistoryWithFen","url","history","pushState","id","MovesRegistry","moves","moveIdx","squareFrom","squareTo","moveEntry","from","to","currentCursor","console","log","cursor","squareColumLetter","squareRowNumber","limitation","currentColumnIdx","indexOf","squares","y","lastSquare","x","yx","cellY","xy","xInc","div","addMarkerCircle","type","typeMarker","squareNode","document","getElementById","use","createElementNS","setAttribute","appendChild","addMarkerRect","addMarkerMoveLast","squareLetter","colIdx","rowInt","content","squareEl","innerHTML","className","classList","add","notClassName","contains","remove","textContent","flipedRows","flipedCols","elements","idx","textEl","textNode","createTextNode","children","i","markersItems","querySelectorAll","invisibleClassName","markerItem","markerId","text","myTemporaryInputElement","createElement","value","body","select","execCommand","removeChild","e","error","ChessControl","callBacks","buffer","squareTarget","panelControls","self","boardSquare","addEventListener","event","targetSquareName","target","srcElement","getAttribute","checkOnSelectSquare","selectedSquare","movePiecesFromSquares","clearBufferAndSelection","clearSelectedSquareFromBuffer","setBufferSquareTarget","button","onAdd","currentTarget","onAddMarker","onClearSquare","onDomainW","onDomainB","onClear","onInit","onDomainsToggle","onDomainsSquare","onShowSquareDomainSupport","onDomainAttacksSquare","onDomainDangerSquare","onShowAttackSquare","onDangerSquare","onFlip","onShowSquareSupport","onRemoveVisuals","onToggleMarkers","onLoadFenFromInput","onLoadFenToInput","onCreateLink","onNavPrev","onNavNext","onNavRecord","item","squareBase","urlParams","params","parser","href","query","search","substring","vars","pair","decodeURIComponent","fenToLoad","configA","colors","movesRegistry","markersMap","fenStr","fenToMap","render","chessControls","actionsBridge","state","isDomainWhiteOn","isDomainBlackOn","move","fenAsObj","Object","entries","drawBoard","then","squareControls","lab","boardCoordinate","originSquare","targetSquare","originPiece","setFigureInSquare","drawPiecesFromMap","currentFen","drawDomainByColor","fenInputStr","set","forceRemove","squareMarkers","selectedMarkerIdInSquare","splice","drawMarkersFromMapBySquareName","targetRows","flankCColLetter","markerItemList","markerIdx","drawMarkersFromMap","svg","svgCoordinates","reverse","coorItem","squareEntry","squareKey","figureText","entryFigure","asLetter","markerEntry","markerItemId","forcedPieceAndColor","options","squareNameParts","squareColumnLetter","squareOptions","squareOptionsVertHorz","squareOptionsDiagonal","drawClearDomains","domainClassName","squaresInDomain","squaresFromFigure","getSquarePieceAllowedSquares","markerIdBySquareColor","addMarkerToSquare","domainSquareName","classNameDomain","classNameColor","_","markerIdByColor","optionSquareKey","pieceInOptionSquare","drawDomainBySquare","ghostPieceInDomain","nextDomainSquareName","isSquareSave","squareMapValue","squareMapKey","squaresOptionsFromFigure","squareMapSquareOptions","uniques","filter","commonSquare","isSquareSupported","debug","drawSupportToSquare","drawSupportToSquareDomain","flipBoard","async","square","drawDangerToSquareDomain","drawAttackFromSquareDomain","drawAttackFromSquare","drawDangerToSquare","drawRemoveAllMarkers","loadFenFromInput","loadFenToInput","linkHref","prevMove","drawFromMove","nextMove","saveMove"],"mappings":"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","file":"main.6cbd0e88ccb686300d59.js","sourcesContent":["export default class Figure {\r\n    constructor(config) {\r\n        this.letterW = config.letterW\r\n        this.iconW = config.iconW;\r\n        this.letterB = config.letterB;\r\n        this.iconB = config.iconB;\r\n    }\r\n\r\n    asLetter(color = true) {\r\n        if (color) {\r\n            return this.letterW;\r\n        }\r\n        return this.letterB;\r\n    }\r\n\r\n    asIcon(color = true) {\r\n        if (color) {\r\n            return this.iconW;\r\n        }\r\n        return this.iconB;\r\n    }\r\n}","import Figure from '../Figure.js'\r\n\r\nexport const rows = [8, 7, 6, 5, 4, 3, 2, 1];\r\nexport const cols = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];\r\n\r\nexport const fenBase = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\r\n\r\nexport const flankQ = ['a', 'b', 'c', 'd', ];\r\nexport const flankK = ['e', 'f', 'g', 'h', ];\r\nexport const flankC = ['c','d', 'e','f' ];\r\n\r\nexport const white = true;\r\nexport const black = false;\r\n\r\nexport const figures = {\r\n    b: new Figure({ letterW: 'B', iconW: '♗', letterB: 'b', iconB: '♝' }),\r\n    r: new Figure({ letterW: 'R', iconW: '♖', letterB: 'r', iconB: '♜' }),\r\n    n: new Figure({ letterW: 'N', iconW: '♘', letterB: 'n', iconB: '♞' }),\r\n    k: new Figure({ letterW: 'K', iconW: '♔', letterB: 'k', iconB: '♚' }),\r\n    q: new Figure({ letterW: 'Q', iconW: '♕', letterB: 'q', iconB: '♛' }),\r\n    p: new Figure({ letterW: 'P', iconW: '♙', letterB: 'p', iconB: '♟' }),\r\n};\r\n","import { cols, white, } from './chess-const.js'\r\n\r\nfunction parseConfig(config){\r\n    return  {\r\n        flip: ('flip' in config) ? config.flip : false,\r\n        asIcon: ('asIcon' in config) ? config.asIcon : true,\r\n        asLines: ('asLines' in config) ? config.asLines : true,\r\n        withLimitation: ('withLimitation' in config) ? config.withLimitation : false,\r\n    }\r\n}\r\n\r\nfunction changeHistoryWithFen( fen ){\r\n    const url = getAbsoluteRouteWithFen(fen);\r\n    history.pushState({\r\n        id: 'game-move'\r\n    }, '', url);\r\n}\r\n\r\nfunction getAbsoluteRouteWithFen(fen){\r\n     return  `${window.location.origin}${window.location.pathname}?fen=${fen}`;\r\n}\r\n\r\nfunction getCellKey(colLetter, rowNumber) {\r\n    return `${colLetter}${rowNumber}`;\r\n}\r\n\r\nfunction createSquaresMap(rows, cols) {\r\n    const listCells = [];\r\n    rows.forEach((row) => {\r\n        cols.forEach((col) => {\r\n            const cellKey = getCellKey(col, row);\r\n            listCells.push([cellKey, null]);\r\n        })\r\n    })\r\n    return new Map(listCells);\r\n}\r\n\r\nfunction createMarkersMap(rows, cols) {\r\n    const listCells = [];\r\n    rows.forEach((row) => {\r\n        cols.forEach((col) => {\r\n            const cellKey = getCellKey(col, row);\r\n            listCells.push([cellKey, []]);\r\n        })\r\n    })\r\n    return new Map(listCells);\r\n}\r\n\r\n\r\nfunction asSquare(letter, color = white) {\r\n    if (letter) {\r\n        return {\r\n            letter: letter,\r\n            color: color,\r\n        };\r\n    } else {\r\n        return null\r\n    }\r\n\r\n}\r\n\r\nfunction parseMapToFenStr(squaresMap) {\r\n    const rows = [8, 7, 6, 5, 4, 3, 2, 1];\r\n    const cols = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];\r\n\r\n    let fenSquarePositions = '';\r\n\r\n    let emptyAccumulator = 0;\r\n\r\n    rows.forEach((row, rowIdx) => {\r\n        emptyAccumulator = 0;\r\n        cols.forEach((col) => {\r\n            const squareName = getCellKey(col, row);\r\n            const squarePiece = squaresMap.get(squareName)\r\n\r\n            if (squarePiece) {\r\n                if (emptyAccumulator !== 0) {\r\n                    fenSquarePositions += emptyAccumulator.toString();\r\n                    emptyAccumulator = 0;\r\n                }\r\n                const pieceLetter = squarePiece.color ? squarePiece.letter.toUpperCase() : squarePiece.letter.toLowerCase()\r\n                fenSquarePositions += pieceLetter;\r\n\r\n            } else {\r\n                emptyAccumulator += 1;\r\n            }\r\n\r\n        })\r\n        if (emptyAccumulator !== 0) {\r\n            fenSquarePositions += emptyAccumulator.toString();\r\n        }\r\n        if (rowIdx < rows.length - 1) {\r\n            fenSquarePositions += '/';\r\n        }\r\n\r\n    })\r\n    const fen = `${fenSquarePositions} w KQkq - 0 1`;\r\n    return fen;\r\n}\r\n\r\nfunction parseFenStrToObject(fen) {\r\n\r\n    const squaresKeyVal = {};\r\n    const allowedLetters = ['r', 'n', 'b', 'k', 'q', 'p', 'R', 'N', 'B', 'K', 'Q', 'P'];\r\n    const fenFiguresSeparator = ' ';\r\n    const fenRowsSeparator = '/';\r\n\r\n    const figuresPart = fen.split(fenFiguresSeparator)[0];\r\n    const strRows = figuresPart.split(fenRowsSeparator);\r\n\r\n    strRows.forEach((rowText, rowIdw) => {\r\n        const boardRowIdx = 8 - rowIdw; // to flip the board ->  rowIdw + 1\r\n        let currentCol = 1;\r\n        rowText.split('').forEach((character) => {\r\n            if (allowedLetters.includes(character)) {\r\n                // it´s a figure letter\r\n                const colLetter = cols[currentCol - 1];\r\n                const cellKey = getCellKey(colLetter, boardRowIdx);\r\n                const color = (character == character.toUpperCase()); // R -> true\r\n                const figureLetter = character.toLowerCase();\r\n                squaresKeyVal[cellKey] = asSquare(figureLetter, color);\r\n                currentCol += 1;\r\n\r\n            } else {\r\n                // should be a number\r\n                const jumpCols = parseInt(character, 10)\r\n                for (let c = currentCol; c < jumpCols + currentCol; c++) {\r\n                    const colLetter = cols[c - 1];\r\n                    const cellKey = getCellKey(colLetter, boardRowIdx);\r\n                    squaresKeyVal[cellKey] = null;\r\n                }\r\n                currentCol += parseInt(character, 10);\r\n            }\r\n        })\r\n    });\r\n    return squaresKeyVal;\r\n}\r\n\r\n\r\nexport default {\r\n    getCellKey,\r\n    createSquaresMap,\r\n    createMarkersMap,\r\n    parseFenStrToObject,\r\n    parseMapToFenStr,\r\n    asSquare,\r\n    parseConfig,\r\n    getAbsoluteRouteWithFen,\r\n    changeHistoryWithFen\r\n}\r\n","import Utils from './chess/chess-utils.js';\r\n\r\nexport default class MovesRegistry {\r\n\r\n    constructor() {\r\n        this.moves = [];\r\n        this.moveIdx = 0;\r\n\r\n    }\r\n\r\n    saveMove(squareFrom, squareTo, squaresMap) {\r\n        const fen = Utils.parseMapToFenStr(squaresMap);\r\n        const moveEntry = {\r\n            from: squareFrom,\r\n            to: squareTo,\r\n            fen: fen\r\n        }\r\n\r\n        const currentCursor = this.moveIdx;\r\n        this.moves.length= currentCursor + 1;\r\n        this.moves.push(moveEntry);\r\n        this.moveIdx = this.moves.length - 1;\r\n    }\r\n\r\n    get currentMoveIdx() {\r\n        return this.moveIdx;\r\n    }\r\n\r\n    get currentMove() {\r\n        return this.moves[this.moveIdx];\r\n    }\r\n\r\n    get prevMove() {\r\n        console.log(this.moves)\r\n        console.log(this.moveIdx)\r\n        let cursor = this.moveIdx - 1;\r\n        console.log(cursor)\r\n        if( cursor <= 0){\r\n            cursor = 0;\r\n        }\r\n       this.moveIdx = cursor;\r\n       return this.moves[cursor];\r\n    }\r\n    get nextMove() {\r\n        let cursor = this.moveIdx + 1;\r\n        if( cursor >= this.moves.length){\r\n            cursor = this.moves.length-1;\r\n        }\r\n        this.moveIdx = cursor;\r\n        return this.moves[cursor ];\r\n    }\r\n\r\n    getMoveByIdx(moveIdx){\r\n        if(moveIdx<this.moves.length){\r\n            return this.moves[this.moveIdx];\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n}\r\n","import { cols } from './chess-const.js';\r\nimport Utils from './chess-utils.js';\r\n\r\n\r\nfunction getSquaresOptionsFromSquareWithR(\r\n    squaresMap,\r\n    squareColumLetter,\r\n    squareRowNumber,\r\n    limitation = false\r\n) {\r\n    const currentColumnIdx = cols.indexOf(squareColumLetter);\r\n    const squares = [];\r\n    for (let y = squareRowNumber - 1; y >= 1; y--) {\r\n        squares.push(Utils.getCellKey(squareColumLetter, y));\r\n        const lastSquare = squares[squares.length - 1];\r\n        if (squaresMap.get(lastSquare) && limitation) {\r\n            break;\r\n        }\r\n    }\r\n    for (let y = squareRowNumber + 1; y <= 8; y++) {\r\n        squares.push(Utils.getCellKey(squareColumLetter, y));\r\n        const lastSquare = squares[squares.length - 1];\r\n        if (squaresMap.get(lastSquare) && limitation) {\r\n            break;\r\n        }\r\n    }\r\n    for (let x = currentColumnIdx + 1; x < cols.length; x++) {\r\n        squares.push(Utils.getCellKey(cols[x], squareRowNumber));\r\n        const lastSquare = squares[squares.length - 1];\r\n        if (squaresMap.get(lastSquare) && limitation) {\r\n            break;\r\n        }\r\n    }\r\n    for (let x = currentColumnIdx - 1; x >= 0; x--) {\r\n        squares.push(Utils.getCellKey(cols[x], squareRowNumber));\r\n        const lastSquare = squares[squares.length - 1];\r\n        if (squaresMap.get(lastSquare) && limitation) {\r\n            break;\r\n        }\r\n    }\r\n    return squares;\r\n}\r\n\r\n\r\nfunction getSquaresOptionsFromSquareWithN(\r\n    squareColumLetter,\r\n    squareRowNumber\r\n) {\r\n    const currentColumnIdx = cols.indexOf(squareColumLetter);\r\n    const squares = [];\r\n    const nCombisYX = [\r\n        [2, 1],\r\n        [1, 2],\r\n        [-1, 2],\r\n        [-2, 1],\r\n        [-2, -1],\r\n        [-1, -2],\r\n        [1, -2],\r\n        [2, -1],\r\n    ];\r\n    nCombisYX.forEach((yx) => {\r\n        const y = squareRowNumber + yx[0];\r\n        const x = currentColumnIdx + yx[1];\r\n        if (x >= 0 && x < cols.length && y > 0 && y <= 8) {\r\n            squares.push(Utils.getCellKey(cols[x], y));\r\n        }\r\n    })\r\n    return squares;\r\n}\r\n\r\n\r\nfunction getSquaresOptionsFromSquareWithP(\r\n    squareColumLetter,\r\n    squareRowNumber,\r\n    color\r\n) {\r\n    const currentColumnIdx = cols.indexOf(squareColumLetter);\r\n    const squares = [];\r\n    const cellY = color ? squareRowNumber + 1 : squareRowNumber - 1;\r\n    const pCombis = [\r\n        [1, cellY],\r\n        [-1, cellY]\r\n    ];\r\n    pCombis.forEach((xy) => {\r\n        const x = currentColumnIdx + xy[0];\r\n        const y = xy[1];\r\n        if (x >= 0 && x < cols.length && y > 0 && y <= 8) {\r\n            squares.push(Utils.getCellKey(cols[x], y));\r\n        }\r\n    });\r\n    return squares;\r\n}\r\n\r\n\r\nfunction getSquaresOptionsFromSquareWithB(\r\n    squaresMap,\r\n    squareColumLetter,\r\n    squareRowNumber,\r\n    limitation = false\r\n) {\r\n    const currentColumnIdx = cols.indexOf(squareColumLetter);\r\n    const squares = [];\r\n\r\n    let xInc = 1;\r\n    for (let y = squareRowNumber - 1; y >= 0; y--) {\r\n        const x = currentColumnIdx + xInc;\r\n        if (x >= 0 && x < cols.length && y > 0 && y <= 8) {\r\n\r\n            squares.push(Utils.getCellKey(cols[x], y))\r\n            xInc++;\r\n            const lastSquare = squares[squares.length - 1];\r\n            if (squaresMap.get(lastSquare) && limitation) {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    xInc = 1;\r\n    for (let y = squareRowNumber - 1; y >= 0; y--) {\r\n        const x = currentColumnIdx - xInc;\r\n        if (x >= 0 && x < cols.length && y > 0 && y <= 8) {\r\n            squares.push(Utils.getCellKey(cols[x], y))\r\n            xInc++;\r\n            const lastSquare = squares[squares.length - 1];\r\n            if (squaresMap.get(lastSquare) && limitation) {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    xInc = 1;\r\n    for (let y = squareRowNumber + 1; y <= 8; y++) {\r\n        const x = currentColumnIdx - xInc;\r\n        if (x >= 0 && x < cols.length && y > 0 && y <= 8) {\r\n\r\n            squares.push(Utils.getCellKey(cols[x], y))\r\n            xInc++;\r\n            const lastSquare = squares[squares.length - 1];\r\n            if (squaresMap.get(lastSquare) && limitation) {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    xInc = 1;\r\n    for (let y = squareRowNumber + 1; y <= 8; y++) {\r\n        const x = currentColumnIdx + xInc;\r\n        if (x >= 0 && x < cols.length && y > 0 && y <= 8) {\r\n            squares.push(Utils.getCellKey(cols[x], y))\r\n            xInc++;\r\n            const lastSquare = squares[squares.length - 1];\r\n            if (squaresMap.get(lastSquare) && limitation) {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    return squares;\r\n}\r\n\r\n\r\nfunction getSquaresOptionsFromSquareWithK(\r\n    squareColumLetter,\r\n    squareRowNumber,\r\n) {\r\n    const currentColumnIdx = cols.indexOf(squareColumLetter);\r\n    const squares = [];\r\n    const kCombisXY = [\r\n        [-1, 0],\r\n        [-1, 1],\r\n        [0, 1],\r\n        [1, 1],\r\n        [1, 0],\r\n        [1, -1],\r\n        [0, -1],\r\n        [-1, -1],\r\n    ];\r\n    kCombisXY.forEach((xy) => {\r\n        const x = currentColumnIdx + xy[0];\r\n        const y = squareRowNumber + xy[1];\r\n        if (x >= 0 && x < cols.length && y > 0 && y <= 8) {\r\n            squares.push(Utils.getCellKey(cols[x], y))\r\n        }\r\n    });\r\n    return squares;\r\n}\r\n\r\nexport default {\r\n    getSquaresOptionsFromSquareWithR,\r\n    getSquaresOptionsFromSquareWithN,\r\n    getSquaresOptionsFromSquareWithP,\r\n    getSquaresOptionsFromSquareWithB,\r\n    getSquaresOptionsFromSquareWithK\r\n}","import { white, } from './chess-const.js'\r\nimport Utils from './chess-utils.js';\r\n\r\nconst boardSize = 90;\r\nconst div = (boardSize / 8);\r\n\r\nfunction drawArrowInSquares(squareFrom, squareTo) {\r\n    // @todo\r\n    // col and row index\r\n    // calculate x,y origin and target\r\n    // marker selection, color, etc..\r\n    // draw line\r\n\r\n    /* Example:\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 350 100\">\r\n        <defs>\r\n            <marker id=\"arrowhead\" markerWidth=\"10\" markerHeight=\"7\"\r\n            refX=\"0\" refY=\"3.5\" orient=\"auto\">\r\n            <polygon points=\"0 0, 10 3.5, 0 7\" />\r\n            </marker>\r\n        </defs>\r\n        <line x1=\"0\" y1=\"50\" x2=\"250\" y2=\"50\" stroke=\"#000\"\r\n        stroke-width=\"8\" marker-end=\"url(#arrowhead)\" />\r\n    </svg>\r\n    */\r\n}\r\n\r\nfunction toggleShowMarkersContainer() {\r\n\r\n    const markersItems = document.querySelectorAll('.markers');\r\n    const invisibleClassName = 'marker-invisible';\r\n    markersItems.forEach(markerItem => {\r\n        if (markerItem.classList.contains(invisibleClassName)) {\r\n            markerItem.classList.remove(invisibleClassName);\r\n        } else {\r\n            markerItem.classList.add(invisibleClassName);\r\n\r\n        }\r\n    });\r\n}\r\n\r\nfunction removeSquareMarkers(squareName) {\r\n    const children = document.getElementById(`markers-${squareName}`).children;\r\n    // Change live list, iterate reverse order\r\n    for (var i = children.length - 1; i >= 0; --i) {\r\n        children[i].remove();\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction addMarkerCircle(squareName, type = null) {\r\n    let typeMarker = 'neutral'\r\n    if (type === white) {\r\n        typeMarker = 'white';\r\n    } else if (type === false) {\r\n        typeMarker = 'black';\r\n    }\r\n    const squareNode = document.getElementById(`markers-${squareName}`);\r\n    const use = document.createElementNS(\"http://www.w3.org/2000/svg\", \"use\");\r\n    use.setAttribute('href', `#marker-circle-${typeMarker}`);\r\n    use.setAttribute('data-square', `${squareName}`);\r\n    squareNode.appendChild(use);\r\n}\r\n\r\nfunction addMarkerRect(squareName, type = true) {\r\n    let typeMarker = type ? 'ok' : 'error';\r\n    const squareNode = document.getElementById(`markers-${squareName}`);\r\n    const use = document.createElementNS(\"http://www.w3.org/2000/svg\", \"use\");\r\n    use.setAttribute('href', `#marker-rect-${typeMarker}`);\r\n    use.setAttribute('data-square', `${squareName}`);\r\n    squareNode.appendChild(use);\r\n}\r\n\r\nfunction addMarkerMoveLast(squareName) {\r\n    const squareNode = document.getElementById(`markers-${squareName}`);\r\n    const use = document.createElementNS(\"http://www.w3.org/2000/svg\", \"use\");\r\n    use.setAttribute('href', `#marker-move-last`);\r\n    use.setAttribute('data-square', `${squareName}`);\r\n    squareNode.appendChild(use);\r\n}\r\n\r\nfunction addMarkerNotation(squareName, text) {\r\n    const textEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"text\");\r\n    const textNode = document.createTextNode(text);\r\n    textEl.setAttribute('x', `${div}%`);\r\n    textEl.setAttribute('y', '0');\r\n    textEl.setAttribute('dy', '3');\r\n    textEl.setAttribute('data-square', `${squareName}`);\r\n    textEl.setAttribute('class', 'marker-square-notation');\r\n    textEl.setAttribute('text-anchor', 'end');\r\n    textEl.appendChild(textNode);\r\n\r\n    const squareNode = document.getElementById(`markers-${squareName}`);\r\n    squareNode.appendChild(textEl);\r\n}\r\n\r\n\r\nfunction createSquare(squareLetter, colIdx, rowInt, rowIdx, asIcon = true) {\r\n\r\n    const squareName = Utils.getCellKey(squareLetter, rowInt);\r\n\r\n    const x = div * colIdx;\r\n    const y = div * rowIdx;\r\n\r\n    const xT = asIcon ? 1.5 : 4;\r\n    const yT = asIcon ? -1.5 : 8;\r\n    const dyT = asIcon ? 10 : 0;\r\n\r\n    const content = `\r\n        <title>${squareName}</title>\r\n        <rect id=\"base-${squareName}\" \r\n            data-square=\"${squareName}\"\r\n            class=\"base\" \r\n            width=\"${div}%\" \r\n            height=\"${div}%\"  />\r\n        <g id=\"markers-${squareName}\" \r\n            data-square=\"${squareName}\"\r\n            class=\"markers\" \r\n            width=\"${div}%\" \r\n            height=\"${div}%\"  \r\n            fill=\"transparent\"\r\n            />\r\n        <text id=\"piece-${squareName}\" \r\n            data-square=\"${squareName}\"\r\n            class=\"piece ${ asIcon ? 'asIcon' : ''}\" \r\n            text-anchor=\"start\" \r\n            x=\"${xT}\" \r\n            y=\"${yT}\" \r\n            dy=\"${dyT}\"\r\n         ></text>\r\n    `;\r\n\r\n    const squareEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\r\n    squareEl.setAttribute('class', 'square');\r\n    squareEl.setAttribute('id', `${squareName}`);\r\n    squareEl.setAttribute('data-square', `${squareName}`);\r\n    squareEl.setAttribute('data-square-col', `${squareLetter}`);\r\n    squareEl.setAttribute('data-square-row', `${rowInt}`);\r\n    squareEl.setAttribute('transform', `translate(${x},${y})`);\r\n\r\n    squareEl.innerHTML = content;\r\n    return squareEl;\r\n}\r\n\r\nfunction setPieceInSquare(squareName, pieceLetter = '', color = true) {\r\n    const squareNode = document.getElementById(`piece-${squareName}`);\r\n    const className = color ? 'white' : 'black';\r\n    squareNode.classList.add(className);\r\n    const notClassName = color ? 'black' : 'white';\r\n    if (color && squareNode.classList.contains(notClassName)) {\r\n        squareNode.classList.remove(notClassName);\r\n    }\r\n    squareNode.textContent = pieceLetter;\r\n}\r\n\r\nfunction createCoordinates(flipedRows, flipedCols) {\r\n    const elements = [];\r\n    flipedCols.forEach((col, idx) => {\r\n        const textEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"text\");\r\n        const textNode = document.createTextNode(col);\r\n        textEl.setAttribute('x', `${div*idx}%`);\r\n        textEl.setAttribute('y', '0');\r\n        textEl.setAttribute('dy', '0');\r\n        textEl.setAttribute('dx', '1');\r\n        textEl.setAttribute('data-coord-col', `${col}`);\r\n        textEl.setAttribute('class', 'board-coordinate board-coordinate-col');\r\n        textEl.setAttribute('text-anchor', 'start');\r\n        textEl.appendChild(textNode);\r\n\r\n        elements.push(textEl);\r\n    })\r\n\r\n    flipedRows.forEach((row, idx) => {\r\n        const textEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"text\");\r\n        const textNode = document.createTextNode(row);\r\n        textEl.setAttribute('x', '0');\r\n        textEl.setAttribute('y', `${div*idx}%`);\r\n        textEl.setAttribute('dy', '6');\r\n        textEl.setAttribute('dx', '-3');\r\n        textEl.setAttribute('data-coord-row', `${row}`);\r\n        textEl.setAttribute('class', 'board-coordinate board-coordinate-row');\r\n        textEl.setAttribute('text-anchor', 'start');\r\n        textEl.appendChild(textNode);\r\n\r\n        elements.push(textEl);\r\n    })\r\n    return elements;\r\n}\r\n\r\nfunction  getMarkerCircleIdByColor(color) {\r\n    return color ? 'marker-circle-white' : 'marker-circle-black';\r\n}\r\n\r\nfunction getDomainClassNameByColor(color) {\r\n    return color ? 'with-domain-white' : 'with-domain-black';\r\n}\r\n\r\nfunction drawMarkerInSquare(squareName, markerId) {\r\n    switch (markerId) {\r\n        case 'marker-circle-white':\r\n            addMarkerCircle(squareName, true);\r\n            break;\r\n        case 'marker-circle-neutral':\r\n            addMarkerCircle(squareName);\r\n            break;\r\n        case 'marker-circle-black':\r\n            addMarkerCircle(squareName, false);\r\n            break;\r\n        case 'marker-move-last':\r\n            addMarkerMoveLast(squareName);\r\n            break;\r\n        case 'marker-rect-ok':\r\n            addMarkerRect(squareName, true);\r\n            break;\r\n        case 'marker-rect-error':\r\n            addMarkerRect(squareName, false);\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n}\r\n\r\nexport default {\r\n    getDomainClassNameByColor,\r\n    getMarkerCircleIdByColor,\r\n    addMarkerCircle,\r\n    addMarkerRect,\r\n    addMarkerMoveLast,\r\n    addMarkerNotation,\r\n    createSquare,\r\n    setPieceInSquare,\r\n    createCoordinates,\r\n    removeSquareMarkers,\r\n    drawArrowInSquares,\r\n    toggleShowMarkersContainer,\r\n    drawMarkerInSquare\r\n}\r\n\r\n/*\r\nSvg.addMarkerCircle('e6', white);\r\nSvg.addMarkerRect('a1');\r\nSvg.addMarkerMoveLast('a2');\r\nSvg.addMarkerRect('e6', false);\r\nSvg.addMarkerNotation('f1', '??');\r\n*/\r\n","function addTextToClipboard( text ){\r\n    try {\r\n        let myTemporaryInputElement = document.createElement('input');\r\n        myTemporaryInputElement.type = 'text';\r\n        myTemporaryInputElement.value = text;\r\n        document.body.appendChild(myTemporaryInputElement);\r\n        myTemporaryInputElement.select();\r\n        document.execCommand('Copy');\r\n        document.body.removeChild(myTemporaryInputElement);\r\n\r\n    } catch (e) {\r\n        console.error('[Clipboard] addTextToClipboard:', e);\r\n    }\r\n}\r\n\r\nexport default {\r\n    addTextToClipboard\r\n}\r\n","export default class ChessControl {\r\n\r\n    constructor(callBacks) {\r\n        this.buffer = {\r\n            squareTarget: null,\r\n        };\r\n        this.callBacks = callBacks;\r\n        this.panelControls();\r\n\r\n    }\r\n\r\n    squareControls() {\r\n        const self = this;\r\n        document.querySelectorAll('.square').forEach(boardSquare => {\r\n            boardSquare.addEventListener('click', function(event) {\r\n                const targetElement = event.target || event.srcElement;\r\n                const targetSquareName = targetElement.getAttribute('data-square');\r\n                // console.log('[CONTROLS] square click:', targetSquareName);\r\n                self.checkOnSelectSquare(targetSquareName);\r\n            }, false);\r\n        })\r\n\r\n    }\r\n\r\n    async checkOnSelectSquare(selectedSquare) {\r\n        // console.log('[CONTROLS] checkOnSelectSquare:', selectedSquare, this.buffer.squareTarget);\r\n        if (this.buffer.squareTarget) {\r\n            if (selectedSquare === this.buffer.squareTarget) {\r\n                this.clearBufferAndSelection();\r\n            } else {\r\n                const moved = await this.callBacks.movePiecesFromSquares(this.buffer.squareTarget, selectedSquare);\r\n                if (moved) {\r\n                    this.clearBufferAndSelection();\r\n                } else {\r\n                    this.clearSelectedSquareFromBuffer()\r\n                    this.setBufferSquareTarget(selectedSquare);\r\n                }\r\n            }\r\n        } else {\r\n            this.setBufferSquareTarget(selectedSquare);\r\n        }\r\n    }\r\n\r\n    panelControls() {\r\n        const self = this;\r\n        document.querySelectorAll('.button-add-fig').forEach(button => {\r\n            button.addEventListener('click', function(event) {\r\n                const targetElement = event.target || event.srcElement;\r\n                const letter = targetElement.getAttribute('data-letter');\r\n                const color = letter === letter.toUpperCase();\r\n                self.callBacks.onAdd(self.buffer.squareTarget, letter.toLowerCase(), color)\r\n                self.clearSelectedSquareFromBuffer();\r\n            }, false);\r\n        })\r\n\r\n\r\n        document.querySelectorAll('.button-marker').forEach(button => {\r\n            button.addEventListener('click', function(event) {\r\n                const targetElement = event.currentTarget;\r\n                const markerId = targetElement.getAttribute('data-marker-id');\r\n                self.callBacks.onAddMarker(self.buffer.squareTarget, markerId)\r\n                self.clearSelectedSquareFromBuffer();\r\n            }, false);\r\n        })\r\n\r\n        const buttonClearSquare = document.getElementById(\"button-clear-square\");\r\n        buttonClearSquare.addEventListener('click', function() {\r\n            self.callBacks.onClearSquare(self.buffer.squareTarget);\r\n            self.clearSelectedSquareFromBuffer();\r\n        }, false);\r\n\r\n        const buttonDomainW = document.getElementById(\"button-paint-domains-w\");\r\n        buttonDomainW.addEventListener('click', function() {\r\n            self.callBacks.onDomainW();\r\n        }, false);\r\n\r\n        const buttonDomainB = document.getElementById(\"button-paint-domains-b\");\r\n        buttonDomainB.addEventListener('click', function() {\r\n            self.callBacks.onDomainB();\r\n        }, false);\r\n\r\n\r\n        const buttonClear = document.getElementById(\"button-clear\");\r\n        buttonClear.addEventListener('click', function() {\r\n            self.callBacks.onClear();\r\n        }, false);\r\n\r\n        const buttonInit = document.getElementById(\"button-init\");\r\n        buttonInit.addEventListener('click', function() {\r\n            self.callBacks.onInit();\r\n        }, false);\r\n\r\n        const buttonDomainsToggle = document.getElementById(\"button-toggle-domains\");\r\n        buttonDomainsToggle.addEventListener('click', function() {\r\n            self.callBacks.onDomainsToggle();\r\n        }, false);\r\n\r\n\r\n\r\n        const buttonSquareDomains = document.getElementById(\"button-paint-domains-square\");\r\n        buttonSquareDomains.addEventListener('click', function() {\r\n            self.callBacks.onDomainsSquare(self.buffer.squareTarget);\r\n            self.clearSelectedSquareFromBuffer();\r\n        }, false);\r\n\r\n        const buttonSquareDomainSupport = document.getElementById(\"button-paint-support-square-domain\");\r\n        buttonSquareDomainSupport.addEventListener('click', function() {\r\n            self.callBacks.onShowSquareDomainSupport(self.buffer.squareTarget);\r\n            self.clearSelectedSquareFromBuffer();\r\n        }, false);\r\n\r\n        const buttonSquareDomainAttacks = document.getElementById(\"button-paint-domain-attack-square\");\r\n        buttonSquareDomainAttacks.addEventListener('click', function() {\r\n            self.callBacks.onDomainAttacksSquare(self.buffer.squareTarget);\r\n            self.clearSelectedSquareFromBuffer();\r\n        }, false);\r\n\r\n        const buttonSquareDomainDanger = document.getElementById(\"button-paint-domain-danger-square\");\r\n        buttonSquareDomainDanger.addEventListener('click', function() {\r\n            self.callBacks.onDomainDangerSquare(self.buffer.squareTarget);\r\n            self.clearSelectedSquareFromBuffer();\r\n        }, false);\r\n\r\n\r\n        const buttonSquareAttack = document.getElementById(\"button-paint-attack-square\");\r\n        buttonSquareAttack.addEventListener('click', function() {\r\n            self.callBacks.onShowAttackSquare(self.buffer.squareTarget);\r\n            self.clearSelectedSquareFromBuffer();\r\n        }, false);\r\n\r\n        const buttonSquareDanger = document.getElementById(\"button-paint-danger-square\");\r\n        buttonSquareDanger.addEventListener('click', function() {\r\n            self.callBacks.onDangerSquare(self.buffer.squareTarget);\r\n            self.clearSelectedSquareFromBuffer();\r\n        }, false);\r\n\r\n\r\n        const buttonFlipBoard = document.getElementById(\"button-board-flip\");\r\n        buttonFlipBoard.addEventListener('click', function() {\r\n            self.callBacks.onFlip(self.buffer.squareTarget);\r\n        }, false);\r\n\r\n        const buttonSquareSupport = document.getElementById(\"button-paint-support-square\");\r\n        buttonSquareSupport.addEventListener('click', function() {\r\n            self.callBacks.onShowSquareSupport(self.buffer.squareTarget);\r\n            self.clearSelectedSquareFromBuffer();\r\n        }, false);\r\n\r\n\r\n\r\n        const buttonVisualsRemove = document.getElementById(\"button-visuals-remove\");\r\n        buttonVisualsRemove.addEventListener('click', function() {\r\n            self.callBacks.onRemoveVisuals();\r\n        }, false);\r\n\r\n        const buttonMarkersToggle = document.getElementById(\"button-markers-toggle\");\r\n        buttonMarkersToggle.addEventListener('click', function() {\r\n            self.callBacks.onToggleMarkers();\r\n        }, false);\r\n\r\n        const buttonFenCreateBoard = document.getElementById(\"button-fen-create-board\");\r\n        buttonFenCreateBoard.addEventListener('click', function() {\r\n            self.callBacks.onLoadFenFromInput();\r\n        }, false);\r\n\r\n        const buttonFenCreateFen = document.getElementById(\"button-fen-create-fen\");\r\n        buttonFenCreateFen.addEventListener('click', function() {\r\n            self.callBacks.onLoadFenToInput();\r\n        }, false);\r\n\r\n        const buttonFenCreateLink = document.getElementById(\"button-fen-create-link\");\r\n        buttonFenCreateLink.addEventListener('click', function() {\r\n            self.callBacks.onCreateLink();\r\n        }, false);\r\n\r\n        const buttonNavPrev = document.getElementById(\"button-nav-prev\");\r\n        buttonNavPrev.addEventListener('click', function() {\r\n            self.callBacks.onNavPrev();\r\n        }, false);\r\n\r\n        const buttonNavNext = document.getElementById(\"button-nav-next\");\r\n        buttonNavNext.addEventListener('click', function() {\r\n            self.callBacks.onNavNext();\r\n        }, false);\r\n\r\n        const buttonNavRecord = document.getElementById(\"button-nav-record\");\r\n        buttonNavRecord.addEventListener('click', function() {\r\n            self.callBacks.onNavRecord();\r\n        }, false);\r\n\r\n    }\r\n\r\n    async setBufferSquareTarget(squareName) {\r\n        this.buffer.squareTarget = squareName;\r\n        if (squareName) {\r\n            const item = document.getElementById(`base-${squareName}`);\r\n\r\n            if (item.classList.contains('with-selection')) {\r\n                item.classList.remove('with-selection');\r\n            } else {\r\n                item.classList.add('with-selection')\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    clearSelectedSquareFromBuffer() {\r\n        const squareName = this.buffer.squareTarget;\r\n        if (squareName) {\r\n            const item = document.getElementById(`base-${squareName}`);\r\n            if (item.classList.contains('with-selection')) {\r\n                item.classList.remove('with-selection');\r\n            }\r\n            this.buffer.squareTarget = null;\r\n        }\r\n    }\r\n\r\n    clearBufferAndSelection() {\r\n        this.buffer.squareTarget = null;\r\n\r\n        document.querySelectorAll('.base').forEach(squareBase => {\r\n            squareBase.classList.remove('with-selection');\r\n        })\r\n\r\n    }\r\n}\r\n","function getParamsFromUrl(url) {\r\n    const params = {};\r\n    let parser = document.createElement('a');\r\n    parser.href = url;\r\n    const query = parser.search.substring(1);\r\n    if (!query) {\r\n        return params;\r\n    }\r\n    const vars = query.split('&');\r\n    for (let i = 0; i < vars.length; i++) {\r\n        const pair = vars[i].split('=');\r\n        params[pair[0]] = decodeURIComponent(pair[1]);\r\n    }\r\n    return params;\r\n};\r\n\r\nexport default {\r\n    getParamsFromUrl\r\n}","import Chess from './js/Chess.js'\r\nimport Url from './js/utils/url.js'\r\nimport './index.scss';\r\n\r\nconst urlParams = Url.getParamsFromUrl(window.location.href);\r\n\r\nlet fenToLoad = null;\r\nif ('fen' in urlParams) {\r\n    fenToLoad = urlParams.fen;\r\n}\r\n\r\nconst configA = {\r\n    fen: fenToLoad,\r\n    asIcon: true,\r\n    asLines: true,\r\n    withLimitation: true,\r\n    flip: false\r\n};\r\n\r\nconst chess = new Chess(configA);\r\n","import { rows, cols, fenBase, white, black, figures, flankC } from './chess/chess-const.js';\r\nimport MovesRegistry from './MovesRegistry.js';\r\nimport Utils from './chess/chess-utils.js';\r\nimport Squares from './chess/chess-squares.js';\r\nimport Svg from './chess/chess-svg.js';\r\nimport Clipboard from './utils/clipboard.js';\r\nimport ChessControls from './chess/chess-controls.js';\r\n\r\nexport default class Chess {\r\n\r\n    constructor(config) {\r\n        // Init\r\n        this.config = Utils.parseConfig(config);\r\n\r\n        this.figures = figures;\r\n        this.colors = {\r\n            white: white,\r\n            black: black,\r\n        };\r\n\r\n        this.movesRegistry = new MovesRegistry();\r\n\r\n        // Run\r\n        this.squaresMap = Utils.createSquaresMap(rows, cols);\r\n        this.markersMap = Utils.createMarkersMap(rows, cols);\r\n\r\n        const fenStr = config.fen || fenBase;\r\n\r\n        this.fenToMap(fenStr);\r\n        this.render();\r\n        this.chessControls = new ChessControls(this.actionsBridge);\r\n\r\n        this.state = {\r\n            isDomainWhiteOn: false,\r\n            isDomainBlackOn: false,\r\n            move: null\r\n        }\r\n    }\r\n\r\n    lab() {\r\n        //this.drawFlankCenterDomains();\r\n        // Svg.drawMarkerInSquare('e4', 'id');\r\n        // this.addMarkerToSquare('e4', 'marker-circle-white');\r\n        // this.actionsBridge.onDomainB()\r\n    }\r\n\r\n    labMoves() {\r\n        // In progress\r\n        //this.move('a2', 'a3');\r\n\r\n    }\r\n\r\n    // ----------------------------------------------- Pieces & Board\r\n    fenToMap(fen) {\r\n        if (!fen || fen === '') {\r\n            return\r\n        }\r\n        const fenAsObj = Utils.parseFenStrToObject(fen);\r\n        this.squaresMap = new Map(Object.entries(fenAsObj));\r\n    }\r\n\r\n    async render() {\r\n        this.drawBoard().then(() => {\r\n            this.chessControls.squareControls();\r\n            this.lab()\r\n        });\r\n    }\r\n\r\n    flipBoard() {\r\n        this.config.flip = !this.config.flip;\r\n        const squares = document.querySelectorAll(\".square\");\r\n        const boardCoordinate = document.querySelectorAll(\".board-coordinate\");\r\n        squares.forEach(squareNode => {\r\n            squareNode.remove();\r\n        });\r\n        boardCoordinate.forEach(squareNode => {\r\n            squareNode.remove();\r\n        })\r\n        this.render()\r\n    }\r\n\r\n    async move(originSquare, targetSquare) {\r\n\r\n        const originPiece = this.squaresMap.get(originSquare);\r\n        if (originPiece) {\r\n            this.setFigureInSquare(targetSquare, originPiece.letter, originPiece.color);\r\n            this.setFigureInSquare(originSquare, null);\r\n            this.drawPiecesFromMap();\r\n            // this.movesRegistry.saveMove(originSquare, targetSquare, this.squaresMap);\r\n            // this.drawRemoveLastStepMoveMarker();\r\n            // this.addMarkerToSquare( originSquare, 'marker-move-last' );\r\n            // this.addMarkerToSquare( targetSquare, 'marker-move-last' );\r\n            const currentFen = Utils.parseMapToFenStr(this.squaresMap);\r\n            Utils.changeHistoryWithFen(currentFen);\r\n\r\n            this.state.move = {\r\n                from: originSquare,\r\n                to: targetSquare,\r\n            };\r\n            // COM: RePaint domains on move\r\n            if(this.state.isDomainWhiteOn)  {\r\n                this.drawDomainByColor(white);\r\n            }\r\n            if(this.state.isDomainBlackOn){\r\n                this.drawDomainByColor(black);\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n\r\n    loadFenFromInput() {\r\n        const fenInputStr = document.getElementById(\"fen-input\").value;\r\n        this.fenToMap(fenInputStr);\r\n        Utils.changeHistoryWithFen(fenInputStr);\r\n        this.drawPiecesFromMap();\r\n    }\r\n\r\n    loadFenToInput() {\r\n        const currentFen = Utils.parseMapToFenStr(this.squaresMap);\r\n        Utils.changeHistoryWithFen(currentFen);\r\n        document.getElementById(\"fen-input\").value = currentFen;\r\n    }\r\n\r\n    // ----------------------------------------------- Moves control\r\n\r\n     drawFromMove(move){\r\n        // analog to this.move()\r\n        this.fenToMap(move.fen);\r\n        this.drawPiecesFromMap();\r\n        // this.drawRemoveLastStepMoveMarker();\r\n        // this.addMarkerToSquare( move.from, 'marker-move-last' );\r\n        // this.addMarkerToSquare( move.to, 'marker-move-last' );\r\n        Utils.changeHistoryWithFen(move.fen);\r\n        // COM: RePaint domains on move\r\n        if(this.state.isDomainWhiteOn)  {\r\n            this.drawDomainByColor(white);\r\n        }\r\n        if(this.state.isDomainBlackOn){\r\n            this.drawDomainByColor(black);\r\n        }\r\n    }\r\n\r\n    // ----------------------------------------------- Maps\r\n\r\n    setFigureInSquare(squareName, letter, color = white) {\r\n        this.squaresMap.set(squareName, Utils.asSquare(letter, color));\r\n    }\r\n\r\n    addMarkerToSquare(squareName, markerId, forceRemove = false) {\r\n        if (!squareName) {\r\n            return\r\n        }\r\n        const squareMarkers = this.markersMap.get(squareName);\r\n\r\n        const selectedMarkerIdInSquare = squareMarkers.indexOf(markerId);\r\n        if (selectedMarkerIdInSquare === -1) {\r\n            squareMarkers.push(markerId);\r\n            this.markersMap.set(squareName, squareMarkers);\r\n            Svg.drawMarkerInSquare(squareName, markerId);\r\n        }\r\n        if (forceRemove && selectedMarkerIdInSquare > -1) {\r\n            squareMarkers.splice(selectedMarkerIdInSquare, 1);\r\n            this.markersMap.set(squareName, squareMarkers);\r\n            this.drawMarkersFromMapBySquareName(squareName);\r\n        }\r\n    }\r\n\r\n    // ----------------------------------------------- Draw: Markers, Pieces\r\n\r\n\r\n    drawFlankCenterDomains(){\r\n        const targetRows = [6,5,4,3];\r\n        const classNameDomain = 'with-flank';\r\n        flankC.forEach( flankCColLetter =>{\r\n            targetRows.forEach(row=>{\r\n               const squareName = Utils.getCellKey(flankCColLetter, row);\r\n                document.getElementById(`base-${squareName}`).classList.add(classNameDomain);\r\n            })\r\n        })\r\n    }\r\n    drawRemoveLastStepMoveMarker(){\r\n        this.markersMap.forEach( markerItemList =>{\r\n            const markerIdx = markerItemList.indexOf('marker-move-last');\r\n            if (markerIdx > -1) {\r\n                markerItemList.splice(markerIdx, 1);\r\n            }\r\n        })\r\n        this.drawMarkersFromMap();\r\n    }\r\n\r\n    async drawBoard() {\r\n        const svg = document.getElementById(\"svg-squares\");\r\n        const svgCoordinates = document.getElementById(\"svg-coordinates\");\r\n        const flip = this.config.flip;\r\n        const flipedRows = flip ? [...rows].reverse() : rows;\r\n        const flipedCols = flip ? [...cols].reverse() : cols;\r\n\r\n        flipedRows.forEach((row, rowIdx) => {\r\n            flipedCols.forEach((colLetter, colIdx) => {\r\n                const squareEl = Svg.createSquare(colLetter, colIdx, row, rowIdx, this.config.asIcon);\r\n                svg.appendChild(squareEl);\r\n            })\r\n        })\r\n        this.drawPiecesFromMap();\r\n        const coordinatesItems = Svg.createCoordinates(flipedRows, flipedCols);\r\n        coordinatesItems.forEach(coorItem => {\r\n            svgCoordinates.appendChild(coorItem);\r\n        })\r\n    }\r\n\r\n    drawPiecesFromMap() {\r\n        this.squaresMap.forEach((squareEntry, squareKey) => {\r\n            if (squareEntry) {\r\n                let figureText = '';\r\n                const entryFigure = figures[squareEntry.letter];\r\n                if (this.config.asIcon === true) {\r\n                    figureText = entryFigure.asIcon(squareEntry.color);\r\n                } else {\r\n                    figureText = entryFigure.asLetter(squareEntry.color);\r\n                }\r\n                Svg.setPieceInSquare(squareKey, figureText, squareEntry.color)\r\n            } else {\r\n                Svg.setPieceInSquare(squareKey)\r\n            }\r\n        })\r\n    }\r\n\r\n    drawMarkersFromMap() {\r\n        this.markersMap.forEach((markerEntry, squareKey) => {\r\n            Svg.removeSquareMarkers(squareKey);\r\n            markerEntry.forEach(markerItemId => {\r\n                Svg.drawMarkerInSquare(squareKey, markerItemId);\r\n            })\r\n        })\r\n    }\r\n\r\n    drawMarkersFromMapBySquareName(squareName) {\r\n        //remove all markers first\r\n        Svg.removeSquareMarkers(squareName);\r\n        // Redraw markers from map\r\n        const squareMarkers = this.markersMap.get(squareName);\r\n        squareMarkers.forEach(markerItemId => {\r\n            Svg.drawMarkerInSquare(squareName, markerItemId);\r\n        })\r\n    }\r\n\r\n    drawRemoveAllMarkers() {\r\n        this.markersMap = Utils.createMarkersMap(rows, cols);\r\n        this.drawMarkersFromMap()\r\n    }\r\n\r\n    // ----------------------------------------------- Engine\r\n    getSquarePieceAllowedSquares(squareName, forcedPieceAndColor = null) {\r\n        const limitation = this.config.withLimitation;\r\n        const options = [];\r\n        if (!squareName) {\r\n            return;\r\n        }\r\n        const squareNameParts = squareName.split('');\r\n        const squareColumnLetter = squareNameParts[0];\r\n        const squareRowNumber = parseInt(squareNameParts[1], 10);\r\n        const { letter, color } = forcedPieceAndColor ? forcedPieceAndColor : this.squaresMap.get(squareName);\r\n        if (letter === 'r') {\r\n            const squareOptions = Squares.getSquaresOptionsFromSquareWithR(this.squaresMap, squareColumnLetter, squareRowNumber, limitation);\r\n            options.push(...squareOptions);\r\n        }\r\n        if (letter === 'n') {\r\n            const squareOptions = Squares.getSquaresOptionsFromSquareWithN(squareColumnLetter, squareRowNumber);\r\n            options.push(...squareOptions);\r\n        }\r\n        if (letter === 'p') {\r\n            const squareOptions = Squares.getSquaresOptionsFromSquareWithP(squareColumnLetter, squareRowNumber, color);\r\n            options.push(...squareOptions);\r\n        }\r\n        if (letter === 'b') {\r\n            const squareOptions = Squares.getSquaresOptionsFromSquareWithB(this.squaresMap, squareColumnLetter, squareRowNumber, limitation);\r\n            options.push(...squareOptions);\r\n        }\r\n        if (letter === 'q') {\r\n            const squareOptionsVertHorz = Squares.getSquaresOptionsFromSquareWithR(this.squaresMap, squareColumnLetter, squareRowNumber, limitation);\r\n            const squareOptionsDiagonal = Squares.getSquaresOptionsFromSquareWithB(this.squaresMap, squareColumnLetter, squareRowNumber, limitation);\r\n            options.push(...squareOptionsVertHorz, ...squareOptionsDiagonal);\r\n        }\r\n        if (letter === 'k') {\r\n            const squareOptions = Squares.getSquaresOptionsFromSquareWithK(squareColumnLetter, squareRowNumber);\r\n            options.push(...squareOptions);\r\n        }\r\n        return options;\r\n    }\r\n\r\n    drawDomainByColor(color = white) {\r\n        this.drawClearDomains(color);\r\n        if (color) {\r\n            this.state.isDomainWhiteOn = true;\r\n        } else {\r\n            this.state.isDomainBlackOn = true;\r\n        }\r\n        const domainClassName = Svg.getDomainClassNameByColor(color);\r\n        const squaresInDomain = []\r\n        this.squaresMap.forEach((squareEntry, squareName) => {\r\n            if (squareEntry && squareEntry.color === color) {\r\n                const squaresFromFigure = this.getSquarePieceAllowedSquares(squareName);\r\n                squaresInDomain.push(...squaresFromFigure);\r\n            }\r\n        })\r\n        squaresInDomain.forEach(squareName => {\r\n            // todo: domain from map\r\n            document.getElementById(`base-${squareName}`).classList.add(domainClassName);\r\n        })\r\n        return squaresInDomain;\r\n    }\r\n\r\n    drawDomainBySquare(squareName) {\r\n        const squarePiece = this.squaresMap.get(squareName);\r\n        if (squarePiece) {\r\n            const markerIdBySquareColor = Svg.getMarkerCircleIdByColor(squarePiece.color);\r\n            this.addMarkerToSquare(squareName, markerIdBySquareColor);\r\n            const squaresFromFigure = this.getSquarePieceAllowedSquares(squareName);\r\n            squaresFromFigure.forEach(domainSquareName => {\r\n                const classNameDomain = Svg.getDomainClassNameByColor(squarePiece.color);\r\n                // todo: domain from map\r\n                document.getElementById(`base-${domainSquareName}`).classList.add(classNameDomain);\r\n            })\r\n        }\r\n    }\r\n\r\n    drawClearDomains(color = white) {\r\n        if (color) {\r\n            this.state.isDomainWhiteOn = false;\r\n        } else {\r\n            this.state.isDomainBlackOn = false;\r\n        }\r\n        const classNameColor = Svg.getDomainClassNameByColor(color);\r\n        this.squaresMap.forEach((_, squareName) => {\r\n            // todo: domain from map\r\n            const classList = document.getElementById(`base-${squareName}`).classList;\r\n            classList.remove(classNameColor);\r\n        });\r\n    }\r\n\r\n    drawAttackFromSquare(squareName) {\r\n        if (!squareName) {\r\n            return;\r\n        }\r\n        const squarePiece = this.squaresMap.get(squareName);\r\n        if (squarePiece) {\r\n            const squareOptions = this.getSquarePieceAllowedSquares(squareName);\r\n            const markerIdByColor = Svg.getMarkerCircleIdByColor(squarePiece.color);\r\n            squareOptions.forEach(optionSquareKey => {\r\n                const pieceInOptionSquare = this.squaresMap.get(optionSquareKey);\r\n                if (pieceInOptionSquare && pieceInOptionSquare.color !== squarePiece.color) {\r\n                    // target!\r\n                    this.addMarkerToSquare(optionSquareKey, markerIdByColor);\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    drawAttackFromSquareDomain(squareName) {\r\n        if (!squareName) {\r\n            return;\r\n        }\r\n        const squarePiece = this.squaresMap.get(squareName);\r\n        if (squarePiece) {\r\n            const markerIdByColor = Svg.getMarkerCircleIdByColor(squarePiece.color);\r\n            const squareOptions = this.getSquarePieceAllowedSquares(squareName);\r\n            this.drawDomainBySquare(squareName);\r\n            squareOptions.forEach(domainSquareName => {\r\n                const ghostPieceInDomain = squarePiece;\r\n                const squareNextOptions = this.getSquarePieceAllowedSquares(domainSquareName, ghostPieceInDomain);\r\n                squareNextOptions.forEach(nextDomainSquareName => {\r\n                    const pieceInOptionSquare = this.squaresMap.get(nextDomainSquareName);\r\n                    if (pieceInOptionSquare && pieceInOptionSquare.color !== squarePiece.color) {\r\n                        // target!\r\n                        this.addMarkerToSquare(squareName, 'marker-circle-neutral');\r\n                        this.addMarkerToSquare(domainSquareName, markerIdByColor);\r\n                        this.addMarkerToSquare(nextDomainSquareName, markerIdByColor);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    drawDangerToSquare(squareName) {\r\n        if (!squareName) {\r\n            return;\r\n        }\r\n        let isSquareSave = true;\r\n        const squarePiece = this.squaresMap.get(squareName);\r\n        if (squarePiece) {\r\n            this.squaresMap.forEach((squareMapValue, squareMapKey) => {\r\n                if (squareMapKey !== squareName && squareMapValue && squareMapValue.color !== squarePiece.color) {\r\n                    const squareMapSquareOptions = this.getSquarePieceAllowedSquares(squareMapKey);\r\n                    // console.debug('[CHESS] drawAttacksToSquare: mapOptions', squareMapSquareOptions);\r\n                    if (squareMapSquareOptions.includes(squareName)) {\r\n                        isSquareSave = false;\r\n                        const markerIdByColor = Svg.getMarkerCircleIdByColor(squareMapValue.color);\r\n                        this.addMarkerToSquare(squareMapKey, markerIdByColor)\r\n                        this.drawDomainBySquare(squareMapKey);\r\n                    }\r\n                }\r\n            })\r\n            if (isSquareSave) {\r\n                this.addMarkerToSquare(squareName, 'marker-rect-ok');\r\n            } else {\r\n                const markerIdBySquareColor = Svg.getMarkerCircleIdByColor(squarePiece.color);\r\n                this.addMarkerToSquare(squareName, markerIdBySquareColor);\r\n            }\r\n        }\r\n    }\r\n\r\n    drawDangerToSquareDomain(squareName) {\r\n        if (!squareName) {\r\n            return;\r\n        }\r\n        let isSquareSave = true;\r\n        const squarePiece = this.squaresMap.get(squareName);\r\n        if (squarePiece) {\r\n            const squaresOptionsFromFigure = this.getSquarePieceAllowedSquares(squareName);\r\n            squaresOptionsFromFigure.forEach(domainSquareName => {\r\n               this.drawDomainBySquare(squareName);\r\n                this.squaresMap.forEach((squareMapValue, squareMapKey) => {\r\n                    if (squareMapKey !== squareName && squareMapValue && squareMapValue.color !== squarePiece.color) {\r\n                        const squareMapSquareOptions = this.getSquarePieceAllowedSquares(squareMapKey);\r\n                        // console.debug('[CHESS] drawAttacksToSquareDomain: mapOptions', squareMapSquareOptions);\r\n                        // console.debug('[CHESS] drawAttacksToSquareDomain: ´fgure', squaresOptionsFromFigure);\r\n\r\n                        const uniques = squaresOptionsFromFigure.filter(value => squareMapSquareOptions.includes(value));\r\n                        uniques.forEach((commonSquare) => {\r\n                            const markerIdByColor = Svg.getMarkerCircleIdByColor(squareMapValue.color);\r\n                            this.addMarkerToSquare(squareMapKey, markerIdByColor);\r\n                            this.addMarkerToSquare(commonSquare, markerIdByColor);\r\n\r\n                        })\r\n                        if (uniques.length > 0) {\r\n                            isSquareSave = false;\r\n                        }\r\n                    }\r\n                })\r\n            })\r\n            if (isSquareSave) {\r\n                this.addMarkerToSquare(squareName, 'marker-rect-ok');\r\n            } else {\r\n\r\n                this.addMarkerToSquare(squareName, 'marker-circle-neutral');\r\n            }\r\n        }\r\n    }\r\n\r\n    drawSupportToSquare(squareName) {\r\n        if (!squareName) {\r\n            return;\r\n        }\r\n        let isSquareSupported = false;\r\n        const squarePiece = this.squaresMap.get(squareName);\r\n        if (squarePiece) {\r\n            this.squaresMap.forEach((squareMapValue, squareMapKey) => {\r\n                if (squareMapKey !== squareName && squareMapValue && squareMapValue.color === squarePiece.color) {\r\n                    const squareMapSquareOptions = this.getSquarePieceAllowedSquares(squareMapKey);\r\n                    console.debug('[CHESS] drawSupportToSquare: mapOptions', squareMapSquareOptions);\r\n                    if (squareMapSquareOptions.includes(squareName)) {\r\n                        isSquareSupported = true;\r\n                        const markerIdByColor = Svg.getMarkerCircleIdByColor(squareMapValue.color);\r\n                        this.addMarkerToSquare(squareMapKey, markerIdByColor)\r\n                        this.drawDomainBySquare(squareMapKey);\r\n                    }\r\n                }\r\n            })\r\n            if (isSquareSupported) {\r\n                this.addMarkerToSquare(squareName, 'marker-rect-ok');\r\n            } else {\r\n                this.addMarkerToSquare(squareName, 'marker-rect-error');\r\n            }\r\n        }\r\n    }\r\n\r\n    drawSupportToSquareDomain(squareName) {\r\n        if (!squareName) {\r\n            return;\r\n        }\r\n        let isSquareSupported = false;\r\n        const squarePiece = this.squaresMap.get(squareName);\r\n        if (squarePiece) {\r\n            this.drawDomainBySquare(squareName);\r\n\r\n            const squaresOptionsFromFigure = this.getSquarePieceAllowedSquares(squareName);\r\n            squaresOptionsFromFigure.forEach(domainSquareName => {\r\n\r\n                this.squaresMap.forEach((squareMapValue, squareMapKey) => {\r\n                    if (squareMapKey !== squareName && squareMapValue && squareMapValue.color === squarePiece.color) {\r\n                        const squareMapSquareOptions = this.getSquarePieceAllowedSquares(squareMapKey);\r\n                        // console.debug('[CHESS] drawSupportToSquareDomain: mapOptions', squareMapSquareOptions);\r\n                        // console.debug('[CHESS] drawSupportToSquareDomain: ´fgure', squaresOptionsFromFigure);\r\n                        const uniques = squaresOptionsFromFigure.filter(value => squareMapSquareOptions.includes(value));\r\n                        uniques.forEach((commonSquare) => {\r\n                            const markerIdByColor = Svg.getMarkerCircleIdByColor(squareMapValue.color);\r\n                            this.addMarkerToSquare(squareMapKey, markerIdByColor);\r\n                            this.addMarkerToSquare(commonSquare, markerIdByColor);\r\n\r\n                        })\r\n                        if (uniques.length > 0) {\r\n                            isSquareSupported = true;\r\n                        }\r\n                    }\r\n                })\r\n            })\r\n            if (isSquareSupported) {\r\n                this.addMarkerToSquare(squareName, 'marker-circle-neutral');\r\n            } else {\r\n                this.addMarkerToSquare(squareName, 'marker-rect-error');\r\n            }\r\n        }\r\n    }\r\n\r\n    // ----------------------------------------------- Control Actions Bridge\r\n    get actionsBridge() {\r\n        return {\r\n            onShowSquareSupport: (squareTarget) => {\r\n                this.drawSupportToSquare(squareTarget);\r\n            },\r\n            onShowSquareDomainSupport: (squareTarget) => {\r\n                this.drawSupportToSquareDomain(squareTarget);\r\n            },\r\n            onFlip: () => {\r\n                this.flipBoard()\r\n            },\r\n            movePiecesFromSquares: async(originSquare, targetSquare) => {\r\n                return this.move(originSquare, targetSquare);\r\n            },\r\n            onAddMarker: (squareTarget, markerId) => {\r\n                this.addMarkerToSquare(squareTarget, markerId, true);\r\n            },\r\n            onAdd: (square, letter, color) => {\r\n                if (!square) { return; }\r\n                this.setFigureInSquare(square, letter, color);\r\n                const currentFen = Utils.parseMapToFenStr(this.squaresMap);\r\n                Utils.changeHistoryWithFen(currentFen);\r\n                this.drawPiecesFromMap();\r\n            },\r\n            onClearSquare: (square) => {\r\n                if (!square) { return; }\r\n                this.setFigureInSquare(square, null);\r\n                const currentFen = Utils.parseMapToFenStr(this.squaresMap);\r\n                Utils.changeHistoryWithFen(currentFen);\r\n                this.drawPiecesFromMap();\r\n            },\r\n            onClear: () => {\r\n                this.squaresMap = Utils.createSquaresMap(rows, cols);\r\n                this.drawPiecesFromMap();\r\n                const currentFen = Utils.parseMapToFenStr(this.squaresMap);\r\n                Utils.changeHistoryWithFen(currentFen);\r\n            },\r\n            onInit: () => {\r\n                this.fenToMap(fenBase);\r\n                this.drawPiecesFromMap();\r\n                Utils.changeHistoryWithFen(fenBase);\r\n            },\r\n            onDomainW: async() => {\r\n                if (!this.state.isDomainWhiteOn) {\r\n                    this.drawDomainByColor(white);\r\n                } else {\r\n                    this.drawClearDomains(white);\r\n                }\r\n            },\r\n            onDomainB: async() => {\r\n                if (!this.state.isDomainBlackOn) {\r\n                    this.drawDomainByColor(black);\r\n                } else {\r\n                    this.drawClearDomains(black);\r\n                }\r\n            },\r\n            onDomainsToggle: async() => {\r\n                if (this.state.isDomainWhiteOn || this.state.isDomainBlackOn) {\r\n                    this.drawClearDomains(white);\r\n                    this.drawClearDomains(black);\r\n                } else {\r\n                    this.drawDomainByColor(white);\r\n                    this.drawDomainByColor(black);\r\n                }\r\n            },\r\n            onDomainsSquare: async(squareName) => {\r\n                this.drawDomainBySquare(squareName);\r\n            },\r\n            onDomainDangerSquare: async(squareName) => {\r\n                this.drawDangerToSquareDomain(squareName);\r\n            },\r\n            onDomainAttacksSquare: async(squareName) => {\r\n                this.drawAttackFromSquareDomain(squareName);\r\n            },\r\n            onShowAttackSquare: async(squareName) => {\r\n                this.drawAttackFromSquare(squareName)\r\n            },\r\n            onDangerSquare: async(squareName) => {\r\n                this.drawDangerToSquare(squareName)\r\n            },\r\n            onRemoveVisuals: () => {\r\n                this.drawRemoveAllMarkers();\r\n                this.drawClearDomains(white);\r\n                this.drawClearDomains(black);\r\n            },\r\n            onToggleMarkers: () => {\r\n                Svg.toggleShowMarkersContainer();\r\n\r\n            },\r\n            onLoadFenFromInput: () => {\r\n                this.loadFenFromInput();\r\n            },\r\n            onLoadFenToInput: () => {\r\n                this.loadFenToInput();\r\n            },\r\n            onCreateLink: () => {\r\n                const currentFen = Utils.parseMapToFenStr(this.squaresMap);\r\n                const linkHref = Utils.getAbsoluteRouteWithFen(currentFen);\r\n                Clipboard.addTextToClipboard(linkHref);\r\n\r\n            },\r\n            onNavPrev:()=>{\r\n                const move = this.movesRegistry.prevMove;\r\n                if(!move){\r\n                    return;\r\n                }\r\n                this.drawFromMove(move);\r\n            },\r\n            onNavNext:()=>{\r\n                const move = this.movesRegistry.nextMove;\r\n                if(!move){\r\n                    return;\r\n                }\r\n                this.drawFromMove(move);\r\n            },\r\n            onNavRecord:()=>{\r\n                const from = this.state.move ? this.state.move.from : null;\r\n                const to = this.state.move ? this.state.move.to : null;\r\n                this.movesRegistry.saveMove(from, from, this.squaresMap);\r\n            },\r\n\r\n        }\r\n    }\r\n\r\n}\r\n"],"sourceRoot":""}